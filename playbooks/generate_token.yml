---
- name: Generate SDP Cloud Access Token
  hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
    - credentials.yml

  tasks:
    # Block-level no_log: all tasks here are redacted; token never appears in logs
    - block:
        - name: Fetch OAuth Token
          manageengine.sdp_cloud.oauth_token:
            client_id: "{{ client_id }}"
            client_secret: "{{ client_secret }}"
            refresh_token: "{{ refresh_token }}"
            dc: "{{ dc }}"
          register: token_output

        - name: Display Access Token info (no token value)
          ansible.builtin.debug:
            msg:
              - "---------------------------------------------------"
              - "Token obtained. Expires In: {{ token_output.expires_in }} seconds"
              - "---------------------------------------------------"
      no_log: true
