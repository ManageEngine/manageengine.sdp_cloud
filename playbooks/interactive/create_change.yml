---
- name: Create a Change via write_record (Interactive)
  hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
    - ../credentials.yml

  vars_prompt:
    - name: change_title
      prompt: "Enter change title"
      private: false

    - name: change_description
      prompt: "Enter change description"
      private: false

  tasks:
    - name: Validate inputs
      ansible.builtin.assert:
        that:
          - change_title | length > 0
          - change_description | length > 0
        fail_msg: "Both title and description are required. Please re-run and provide values."

    - name: Fetch OAuth Token
      manageengine.sdp_cloud.oauth_token:
        client_id: "{{ client_id }}"
        client_secret: "{{ client_secret }}"
        refresh_token: "{{ refresh_token }}"
        dc: "{{ dc }}"
      register: token_output
      no_log: true

    - name: Create a Change using write_record
      manageengine.sdp_cloud.write_record:
        domain: "{{ domain }}"
        parent_module_name: "change"
        auth_token: "{{ token_output.access_token }}"
        dc: "{{ dc }}"
        portal_name: "{{ portal_name }}"
        payload:
          title: "{{ change_title }}"
          description: "{{ change_description }}"
      register: new_change

    - name: Display created change
      ansible.builtin.debug:
        msg:
          - "══════════════════════════════════════════"
          - "  Change created successfully!"
          - "  ID:          {{ new_change.response.change.id | default('N/A') }}"
          - "  Title:       {{ new_change.response.change.title | default('N/A') }}"
          - "  Description: {{ new_change.response.change.description | default('N/A') }}"
          - "══════════════════════════════════════════"
